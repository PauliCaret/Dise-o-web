;/*FB_PKG_DELIM*/

__d("MAWRestoreMessagesFromEncryptedBackupsNOP",["ExecutionEnvironment","I64","LSDataTraceCheckPoint","LSIntEnum","LSMEBTaskCreationSource","MAWAsyncEBPendingQueryPromise","MAWBridgeTraceRecordCheckpointHandler","MAWBridgeUpdateClientRestoreStatus","MAWChatJid","MAWEBRestoreTrackingUtils","MAWEncryptedBackupsUpdateGlobalRestoreStatus","MAWJobDefinitions","MAWJobManager","MAWMIC","MAWOfflineQueueStatus","MAWTimedJob","MAWUpdateClientRestoreStatusOperationType","Promise","ReQL","WAJobOrchestratorTypes","WALoggerDeferred","WATagsLogger","asyncToGeneratorRuntime","cr:4992","err","gkx","promiseDone"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k;function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Calling worker job for thread "," StartSortKey: "," messagesCount: ",""]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Calling prefetch for thread ",""]);m=function(){return a};return a}function n(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web] Failed to get thread key for "," when calling restoreMessagesFromEncryptedBackup"]);n=function(){return a};return a}function o(){var a=babelHelpers.taggedTemplateLiteralLoose(["[labyrinth_web][","] Received echo documents for thread: "," startSortKey: "," messagesCount: ",""]);o=function(){return a};return a}function p(a,b){return q.apply(this,arguments)}function q(){q=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,c){try{c=(yield d("MAWChatJid").toThreadKeyMaybeForChatJidInteger(a,(k||(k=d("I64"))).of_string(c)));if(c!=null){a=(yield d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.messages_ranges_v2__generated).getKeyRange(c)));if(a!=null)return a.minMessageId}}catch(a){return(i||(i=b("Promise"))).reject(a)}return});return q.apply(this,arguments)}function r(a,b,c){return s.apply(this,arguments)}function s(){s=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c){if(b===0){yield d("MAWMIC").startMAWMICFlow();d("MAWMIC").markEvent("eb_restore_start");c&&d("MAWMIC").markEvent("eb_prefetch_start");return d("ReQL").toArrayAsync(d("ReQL").fromTableAscending(a.mi_act_mapping_table)).then(function(a){a.forEach(function(a){a=d("MAWJobDefinitions").toThreadJidPrimaryId((k||(k=d("I64"))).to_string(a.jid));d("MAWEncryptedBackupsUpdateGlobalRestoreStatus").addThreadIdToStatusArray(a,"restore");c&&d("MAWEncryptedBackupsUpdateGlobalRestoreStatus").addThreadIdToStatusArray(a,"ebprefetch")})})}});return s.apply(this,arguments)}function a(a,b,c,d,e,f,g,h,i,j,k,l,m){return t.apply(this,arguments)}function t(){t=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,e,f,g,h,q,s,t,v,w,x,y,z){var A;d("WATagsLogger").TAGS(["labyrinth_web","eb_restore",(A=w)!=null?A:""]).LOG(o(),(A=w)!=null?A:"",f,x,g.length);A=(yield d("MAWChatJid").toThreadKeyMaybeForChatJidInteger(a,(k||(k=d("I64"))).of_string(f)));A==null&&void d("WALoggerDeferred").ERROR(n(),f);A=!d("MAWOfflineQueueStatus").isOfflineQueueComplete()&&b("cr:4992")!=null&&x==null&&f!=null;var B=d("MAWEncryptedBackupsUpdateGlobalRestoreStatus").getCurrentGlobalRestoreStatusArrayLength("restore");yield r(a,B,A);try{B=(yield p(a,f));if(A&&b("cr:4992")!=null){d("WATagsLogger").TAGS(["labyrinth_web","eb_prefetch",(A=w)!=null?A:""]).LOG(m(),f);d("MAWEBRestoreTrackingUtils").markEBRestoreFrontloaded(y,w);A={action:d("MAWUpdateClientRestoreStatusOperationType").upsertClientRestoreStatus,threadId:f};yield d("MAWBridgeUpdateClientRestoreStatus").call(a,A);yield b("cr:4992")(a,e,f,g,h,q,s,t,v,w,x,B,y,z)}else{d("WATagsLogger").TAGS(["labyrinth_web","eb_restore",(A=w)!=null?A:""]).LOG(l(),f,x,g.length);c("promiseDone")(u(e,f,g,B,h,s,v,w,x,y,z),function(){w!=null&&d("MAWEBRestoreTrackingUtils").addQPLRestorePoint({pointName:"native_op_end",traceId:w,type:"echo"})})}}catch(e){if(w!=null)return d("MAWBridgeTraceRecordCheckpointHandler").call(a,{checkPointId:(j||(j=d("LSIntEnum"))).ofNumber(c("LSDataTraceCheckPoint").FLOW_END_FOR_FAILURE),dataTraceId:w,errorMessage:e,shouldFlush:!0,syncChannel:-1,tags:void 0}).then(function(){return(i||(i=b("Promise"))).reject(e)})}});return t.apply(this,arguments)}function u(a,e,f,g,j,k,l,m,n,o,p){var q=(h||(h=c("ExecutionEnvironment"))).isInWorker?d("MAWJobManager").getJobManager():d("MAWTimedJob").TimedUIJobStarters;if(m!=null&&o===c("LSMEBTaskCreationSource").MESSENGER_MESSAGE_LIST_PAGINATION){var r;return q.waitUntilCompleted(d("MAWJobDefinitions").jobSerializers.restoreMessagesFromEncryptedBackups(a,e,f,j,k,l,(r=g)!=null?r:void 0,(r=m)!=null?r:void 0,(r=n)!=null?r:void 0,void 0,void 0,o,{priority:d("WAJobOrchestratorTypes").JOB_PRIORITY.UI_ACTION},p)).then(function(a){if(!c("gkx")("23935"))if(a.success===!0)d("MAWAsyncEBPendingQueryPromise").resolvePendingQueryUponReStore(m);else{var b;d("MAWAsyncEBPendingQueryPromise").rejectPendingQueryIfPresent(m,(b=a.payload)!=null?b:c("err")(a.error))}})}return(i||(i=b("Promise"))).resolve(q.fireAndForget(d("MAWJobDefinitions").jobSerializers.restoreMessagesFromEncryptedBackups(a,e,f,j,k,l,(r=g)!=null?r:void 0,(q=m)!=null?q:void 0,(a=n)!=null?a:void 0,void 0,void 0,o,{priority:d("WAJobOrchestratorTypes").JOB_PRIORITY.UI_ACTION},p)))}g.call=a}),98);
__d("MediaStream",[],(function(a,b,c,d,e,f){"use strict";a=window.MediaStream||window.webkitMediaStream;f["default"]=a}),66);